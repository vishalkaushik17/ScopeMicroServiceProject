cacheKey="BookCollectionModule";sessionId=`BookCollections_${scopeTokenData.id}`;apiModule="BookCollection";apiUrlToGetAll=`https://localhost/ApiGateway/${apiModule}/getall?useCache=false`;apiUrlToGetById=`https://localhost/ApiGateway/${apiModule}/get??useCache=false&id=`;jsFormObject={};$(document).ready(async function(){$("#LayoutUl li").removeClass("active");$("#LibraryLI").addClass("active treeview");$("#BookCollection-LibraryModule a").css({color:"darkblue","font-weight":"bold"});jsFormObject.apiUrlToGetAll=apiUrlToGetAll;jsFormObject.cacheKey=cacheKey;jsFormObject.sessionId=sessionId;jsFormObject.FillIndex=fillBookCollectionIndex;jsFormObject.useCache=!0;PopulateItemsTable()});$(document).on("click",".open-BookCollectionModel",async function(){let t=$(this).data("id");showLoader();changeButtonCRUDState();let n={};n.apiUrlToGetById=apiUrlToGetById;n.id=t;loadBookCollectionData(n)});let loadBookCollectionData=async function(n){$.ajax({type:"GET",datatype:"json",url:`${n.apiUrlToGetById}${n.id}`,headers:{School:jsTokenObject.schoolName,Authorization:jsTokenObject.token,"Content-Type":"application/json; charset=utf-8"},success:function(n){n.status==="Success"&&(hideLoader(),$("#modal-default").modal("show"),FillBookCollectionModelFormForEditing(n.Result));n.Result.isEditable===!1&&($("#saveLi").css("display","none"),$("#cancelLi").css("display","block"))},error:function(n,t,i){console.log(n);console.log(t);console.log(i);toastr.warning("Opps! something went wrong!","Error")},complete:function(){hideLoader()}})},FillBookCollectionModelFormForEditing=async function(n){$("#Name").val(n.name);$("#Abbreviation").val(n.abbreviation);$("#Id").val(n.id)},addRowToBookCollectionIndex=async function(n,t,i){let r=!1;return $.each(n.Result,function(n,u){u.id===i&&(u.name=t.name,u.abbreviation=t.abbreviation,u.isEditable=!0,r=!0)}),r||(t.isEditable=!0,n.Result.push(t)),await SetDataToLocalStorage(cacheKey,sessionId,n,20)},fillBookCollectionIndex=function(n){let t="#",i="#",r="#";$.each(n.Result,function(n,u){let f="<tr>";t="'#modal-default' class='open-BookCollectionModel'";i="class='delete-BookCollectionRecord'";r="<i class='ion ion-trash-b btn btn-warning' style='font-size:20px;'><\/i>";f+=`<td> <a href=${t} data-id=${u.id} </a>${u.name}</td>`;f+=`<td> ${u.abbreviation}</td>`;f+=u.isEditable===!0?`<td> <a href='#' ${i} data-id=${u.id} &nbsp&nbsp</a> ${r} </td>`:"<td> <a href='#'><\/a><\/td>";f+="<\/tr>";$("#indexDataTable tbody").append(f)});$("#indexDataTable").DataTable().draw();$("#indexDataTable_filter > label > input").addClass("searchRecords");$("#indexDataTable_filter > label").addClass("searchLabel");$("#indexDataTable_length > label").addClass("searchLabel")};$("#modelFormBookCollection").submit(async function(n){showLoader();n.preventDefault();let i=getFormElementsData($(this)).Id,u=JSON.stringify(getFormElementsData($(this))),r=`https://localhost/ApiGateway/${apiModule}/save?useCache=${backroundCache}`;i!=""&&(r=`https://localhost/ApiGateway/${apiModule}/update?id=${i}&useCache=${backroundCache}`);let t={};t.urlPathToSave=r;t.formData=u;t.cacheKey=cacheKey;t.id=sessionId;t.apiUrlToGetAll=`https://localhost/ApiGateway/${apiModule}/getall?useCache=${backroundCache}`;t.fnTableFill=fillBookCollectionIndex;await submitBookCollectionModelForm(t)});let submitBookCollectionModelForm=async function(n){$.ajax({type:"POST",url:n.urlPathToSave,data:n.formData,headers:{School:jsTokenObject.schoolName,Authorization:jsTokenObject.token,"Content-Type":"application/json; charset=utf-8"},beforeSend:function(){showLoader()},success:function(t){if(displayAlert(t),t.status==="Success"){let i=t.Result;$("#modal-default").modal("toggle");$("#indexDataTable").DataTable().destroy();$("#indexDataTable tbody").empty();GetDataFromLocalStorage(n.cacheKey,n.id,n.useCache).then(function(r){r?(addRowToBookCollectionIndex(r,i,t.Result.id),n.fnTableFill(r)):printLog("No cache data","local cache")}).catch(n=>{console.log(n.message)});$("#modelForm").each(function(){this.reset()});$("#Id").val("");$("#Name").val("");$("#Abbreviation").val("");resetButtonState()}hideLoader()},error:function(n,t,i){console.log(n);console.log(t);console.log(i);toastr.warning("Opps! Something went wrong!","Error")},complete:function(){hideLoader()}})};$(document).on("click",".delete-BookCollectionRecord",async function(){let n=$(this).data("id"),t=$(this);swal({title:"Are you sure?",text:"Once deleted, you will not be able to recover this record!",icon:"warning",buttons:!0,dangerMode:!0}).then(i=>{i&&(showLoader(),deleteBookCollectionData(t,`https://localhost/ApiGateway/${apiModule}/delete?id=${n}&useCache=${backroundCache}`))})});let deleteBookCollectionData=async function(n,t){$.ajax({type:"GET",datatype:"json",url:t,headers:{School:jsTokenObject.schoolName,Authorization:jsTokenObject.token,"Content-Type":"application/json; charset=utf-8"},success:function(t){if(hideLoader(),t.status==="Success"){GetDataFromLocalStorage(`${cacheKey}`,sessionId,jsFormObject.useCache).then(function(n){if(n&&(n.Result=n.Result.filter(n=>n.id!==t.Result.id),SetDataToLocalStorage(`${cacheKey}`,sessionId,n,20),n.Result.length>0)){fillBookCollectionIndex(n);$(".searchLabel").focus();return}});swal("Ohh! Your record has been deleted!",{icon:"success",timer:3e3});let i=$("#indexDataTable").DataTable();i.row(n.parents("tr")).remove().draw()}else swal("Ohh! "+t.message,{icon:"error"})},error:function(n,t,i){console.log(n);console.log(t);console.log(i);toastr.warning(i,"Error!");hideLoader()},complete:function(){hideLoader()}})};