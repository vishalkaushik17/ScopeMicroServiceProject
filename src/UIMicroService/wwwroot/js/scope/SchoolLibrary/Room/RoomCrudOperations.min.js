var cacheKeyLibrary="LibraryModule",cacheKeyRoom="RoomModule",sessionId=`Rooms_${scopeTokenData.id}`,apiModuleLibrary="Library",apiModuleRoom="Room",libId="",roomId="",apiUrlToGetAllLibrary=`https://localhost/ApiGateway/${apiModuleLibrary}/getall`,apiUrlToGetAllRooms=`https://localhost/ApiGateway/${apiModuleRoom}/getall?libraryId=${libId}`,apiUrlToRoomGetById=`https://localhost/ApiGateway/${apiModuleRoom}/get?libraryId=${libId}&roomId=${roomId}`,clearCache=async function(){await AdminLayout.clear().then(function(){SetDataToLocalStorage("Config","Application Configuration",defaultValue)}).catch(function(n){console.log(n)})},PopulateItemsOnRoomTable,submitForm,loadRoomRecord,deleteRoomData;$(document).ready(async function(){$("#LayoutUl li").removeClass("active");$("#LibraryLI").addClass("active treeview");$("#Room-LibraryModule a").css({color:"darkblue","font-weight":"bold"});jsFormObject.apiUrlToGetAllLibrary=apiUrlToGetAllLibrary;jsFormObject.cacheKeyLibrary=cacheKeyLibrary;jsFormObject.cacheKeyRoom=cacheKeyRoom;jsFormObject.sessionId=sessionId;jsFormObject.FillIndex=fillRoomIndex;jsFormObject.useCache=!0;jsFormObject.fillLibrarySelectList=fillDataInLibrarySelectList;var n=await GetConfigData("Config");backroundCache=n.UseRedisCache;await PopulateLibrary(jsFormObject,$("#SelectedLibraries"))});let RefreshRoomIndexWithoutCache=async function(){$("#indexDataTable").DataTable().destroy();$("#indexDataTable tbody").empty();await PopulateLibrary(jsFormObject,$("#SelectedLibraries"))},PopulateLibrary=async function(n,t){var i=await GetDataFromLocalStorage(n.cacheKeyLibrary,n.sessionId,n.useCache);if(i!==null){n.fillLibrarySelectList(i,t);t.focus();return}window.$.ajax({url:`https://localhost/ApiGateway/${apiModuleLibrary}/getall?useCache=${backroundCache}`,type:"GET",datatype:"json",headers:{School:jsTokenObject.schoolName,Authorization:jsTokenObject.token},beforeSend:function(){showLoader()},success:function(i){i.status==="Success"&&(SetDataToLocalStorage(n.cacheKeyLibrary,n.sessionId,i,20),n.fillLibrarySelectList(i,t),t.focus())},error(n){console.log(n);toastr.error("Oops! something went wrong!","Error!");hideLoader()},complete:function(){hideLoader()}})};$("#SelectedLibraries").on("change",async function(){$("#indexDataTable").DataTable().destroy();$("#indexDataTable tbody").empty();PopulateItemsOnRoomTable(this.value,jsFormObject)});PopulateItemsOnRoomTable=async function(n,t){if(n!==""&&n!=="-1"){var i=await GetDataFromLocalStorage(`${t.cacheKeyRoom}_${n}`,t.sessionId,t.useCache);if(i!=null){fillRoomIndex(i,$("#SelectedLibraries"));window.$("#SelectedLibraries").focus();return}$.ajax({url:`https://localhost/ApiGateway/room/getAll?useCache=${backroundCache}&libraryId=${n}`,type:"GET",datatype:"application/json",headers:{School:jsTokenObject.schoolName,Authorization:jsTokenObject.token,"Content-Type":"application/json; charset=utf-8"},beforeSend:function(){showLoader()},success:function(i){i.status==="Success"&&(SetDataToLocalStorage(`${t.cacheKeyRoom}_${n}`,t.sessionId,i,20),fillRoomIndex(i,$("#SelectedLibraries")),window.$("#SelectedLibraries").focus())},error(n){console.log(n);$(window).ready(hideLoader);toastr.error("Oops! something went wrong!","Error!");setTimeout(hideLoader,2e4)},complete:function(){$(window).ready(hideLoader);setTimeout(hideLoader,2e4)}})}};let fillDataInLibrarySelectList=async function(n,t){t.empty();t.append($("<option><\/option>").attr("value",-1).text("Select Library"));$.each(n.Result,function(n,i){t.append($("<option><\/option>").attr("value",i.id).text(i.name))})},fillRoomIndex=async function(n){$.each(n.Result,function(n,t){var i="<tr>";hrefid="#modal-default class='open-RoomModel'";hrefdel="class='delete-RoomRecord'";hrefEdit="class='open-RoomModel'";editIcon="<i class='ion ion-edit btn btn-info' style='font-size:20px;'><\/i>";delIcon="<i class='ion ion-trash-b btn btn-warning' style='font-size:20px;'><\/i>";i+="<td> <a href= "+hrefid+" data-id='"+t.id+"' data-libraryid='"+t.libraryId+"'>"+t.name+"<\/a><\/td>";t.isEditable==!0?(i+="<td> <a href='#' "+hrefEdit+" data-id='"+t.id+"' data-libraryid='"+t.libraryId+"' >&nbsp&nbsp"+editIcon+"<\/a><a href='#' "+hrefdel+" data-id='"+t.id+"' data-libraryid='"+t.libraryId+"' >&nbsp&nbsp"+delIcon+"<\/a>","<\/td>"):i+="<td> <a href='#'><\/a><\/td>";i+="<\/tr>";$("#indexDataTable tbody").append(i)});$("#indexDataTable").DataTable().draw();$("#indexDataTable_filter > label > input").addClass("searchRecords");$("#indexDataTable_filter > label").addClass("searchLabel");$("#indexDataTable_length > label").addClass("searchLabel")};$("#newRecord").click(function(){changeButtonCRUDState();PopulateLibrary(jsFormObject,$("#Libraries"));$("#Name").prop("disabled",!0)});$("#Libraries").on("change",async function(){if(this.value==="-1"){$("#Name").prop("disabled",!0);return}$("#Name").prop("disabled",!1);$("#LibraryId").val(this.value)});$("#modelFormRoom").submit(async function(n){showLoader();n.preventDefault();$("#LibraryId").val($("#Libraries").find(":selected").val());let i=getFormElementsData($(this)).Id;var u=JSON.stringify(getFormElementsData($(this)));let r=`https://localhost/ApiGateway/${apiModuleRoom}/save?useCache=${backroundCache}`;i!==""&&(r=`https://localhost/ApiGateway/${apiModuleRoom}/update?id=${i}&useCache=${backroundCache}`);let t={};t.urlPathToSave=r;t.formData=u;t.cacheKeyLibrary=cacheKeyLibrary;t.cacheKeyRoom=cacheKeyRoom;t.sessionId=`Rooms_${scopeTokenData.id}`;t.apiUrlToGetAll=`https://localhost/ApiGateway/${apiModuleRoom}/getall?libraryId=${libId}`;t.fnTableFill=fillRoomIndex;await submitForm(t)});submitForm=async function(n){$.ajax({type:"POST",url:n.urlPathToSave,data:n.formData,headers:{School:jsTokenObject.schoolName,Authorization:jsTokenObject.token,"Content-Type":"application/json; charset=utf-8"},beforeSend:function(){showLoader()},success:function(t){if(displayAlert(t),t.status==="Success"){$("#modal-default").modal("toggle");$("#indexDataTable").DataTable().destroy();$("#indexDataTable tbody").empty();let r=$("#LibraryId").val();n.libId=r;printLog(`${n.cacheKeyRoom}_${r}`,"id check");GetDataFromLocalStorage(`${n.cacheKeyRoom}_${r}`,n.sessionId,n.useCache).then(function(i){i?(addRowToIndex(i,t.Result,t.Result.id,n),n.fnTableFill(i)):PopulateItemsOnRoomTable(r,n)}).catch(n=>{console.log(n.message)});var i=$("#Libraries").find(":selected").text();$("#SelectedLibraries").find("option:contains("+i+")").attr("selected","selected");$("#modelFormRoom").each(function(){this.reset();$("#Id").val("")});resetButtonState()}hideLoader()},error:function(n,t,i){console.log(n);console.log(t);console.log(i);toastr.warning("Opps! Something went wrong!","Error")},complete:function(){hideLoader()}})};let addRowToIndex=async function(n,t,i,r){let u=!1;return $.each(n.Result,function(n,r){r.id===i&&(r.name=t.name,r.isEditable=!0,u=!0)}),u||(t.isEditable=!0,n.Result.push(t)),printLog(`${r.cacheKeyRoom}_${r.libId}`,"check here"),await SetDataToLocalStorage(`${r.cacheKeyRoom}_${r.libId}`,r.sessionId,n,20)};$(document).on("click",".open-RoomModel",async function(){var n=$(this).attr("data-id"),t=$(this).attr("data-libraryid");showLoader();$("#modal-default").modal("show");changeButtonCRUDState();loadRoomRecord(n,t)});loadRoomRecord=async function(n,t){$.ajax({type:"GET",datatype:"json",url:`https://localhost/ApiGateway/room/get?id=${n}&LibraryId=${t}`,headers:{School:jsTokenObject.schoolName,Authorization:jsTokenObject.token,"Content-Type":"application/json; charset=utf-8"},success:function(n){n.status==="Success"&&($("#Name").val(n.Result.name),$("#Id").val(n.Result.id),$("#LibraryId").val(t),$("#Libraries").empty(),$("#SelectedLibraries option").each(function(){console.log("Text:-"+this.text+"  Value:-"+this.value);this.value===t?$("#Libraries").append($("<option selected><\/option>").attr("value",this.value).text(this.text)):$("#Libraries").append($("<option><\/option>").attr("value",this.value).text(this.text))}),$("#Libraries").prop("disabled",!0),$("#Libraries").attr("title","Moving room to another library is not permitted!"),n.Result.isEditable===!1&&($("#saveLi").css("display","none"),$("#cancelLi").css("display","block")),hideLoader())},error:function(n,t,i){console.log(n);console.log(t);console.log(i);toastr.warning("Opps! something went wrong!","Error");hideLoader()}})};$(document).on("click",".delete-RoomRecord",async function(){var t=$(this).data("id"),n;let i=$(this);n=$("#SelectedLibraries").find(":selected").val();swal({title:"Are you sure?",text:"Once deleted, you will not be able to recover this record!",icon:"warning",buttons:!0,dangerMode:!0}).then(r=>{r&&(showLoader(),deleteRoomData(i,`https://localhost/ApiGateway/room/delete?useCache=${backroundCache}&id=${t}&libraryId=${n}`,n))})});deleteRoomData=function(n,t,i){$.ajax({type:"GET",datatype:"json",url:t,headers:{School:jsTokenObject.schoolName,Authorization:jsTokenObject.token,"Content-Type":"application/json; charset=utf-8"},success:function(t){if(GetDataFromLocalStorage(`${cacheKeyRoom}_${i}`,sessionId,jsFormObject.useCache).then(function(n){if(n&&(n.Result=n.Result.filter(n=>n.id!==t.Result.id),SetDataToLocalStorage(`${cacheKeyRoom}_${i}`,sessionId,n,20),n.Result.length>0)){fillRoomIndex(n);$(".searchLabel").focus();return}}),hideLoader(),t.status==="Success"){swal("Ohh! Your record has been deleted!",{icon:"success",timer:3e3});var r=$("#indexDataTable").DataTable();r.row(n.parents("tr")).remove().draw()}else swal("Ohh! "+t.message,{icon:"error"})},error:function(n,t,i){console.log(n);console.log(t);console.log(i);toastr.warning(i,"Error!");hideLoader()},complete:function(){hideLoader()}})};